<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Instagram Reels Clone</title>
  <link rel="stylesheet" href="./style.css" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/swiper@8/swiper-bundle.min.css" />
  <script src="https://unpkg.com/swiper@8/swiper-bundle.min.js"></script>
</head>

<body>
  <script src="./mpd-parser.js"></script>
  <script src='https://unpkg.com/@ffmpeg/ffmpeg/dist/ffmpeg.min.js'></script>
  <script src="./main.js"></script>

  <!--
  <div class="app__videos"></div>-->
  <div class="swiper-container">
    <div class="swiper-wrapper">
      <div class="swiper-slide" data-slide-type="img">Slide 1</div>
      <div class="swiper-slide" data-slide-type="img">Slide 2</div>
      <div class="swiper-slide" data-slide-type="img">Slide 3</div>
      <div class="swiper-slide" data-slide-type="img">Slide 5</div>
      <div class="swiper-slide" data-slide-type="img">Slide 6</div>
      <div class="swiper-slide" data-slide-type="img">
        <video class="video__player" controls="controls" muted="muted">
          <source type="video/mp4" src="https://v.redd.it/c97vfkhh28hz/DASH_2_4_M?source=fallback"><audio
            controls="controls">
            <source type="audio/mp4" src="https://v.redd.it/c97vfkhh28hz/audio">
          </audio>
        </video>
      </div>
    </div>
    <!-- Add Arrows -->
    <div class="swiper-button-next"></div>
    <div class="swiper-button-prev"></div>
  </div>
  <script>
    // variable 
    var VIDEO_PLAYING_STATE = {
      "PLAYING": "PLAYING",
      "PAUSE": "PAUSE"
    }
    var videoPlayStatus = VIDEO_PLAYING_STATE.PAUSE
    var timeout = null
    var waiting = 3000
    var swiper = new Swiper(
      '.swiper-container', {
      direction: "vertical",
      navigation: {
        nextEl: '.swiper-button-next',
        prevEl: '.swiper-button-prev',
        clickable: true,
      },
    });

    swiper.on('slideChange', function () {
      console.log('slide changed');
      /* stop all videos (currentTime buggy without this loop idea - no "real" previousIndex) */
      /*var sliderVideos = $(".swiper-slide video");
      sliderVideos.each(function (index) {
        this.currentTime = 0;
      });*/

      /* SWIPER GET CURRENT AND PREV SLIDE (AND VIDEO INSIDE) */
      //var prevVideo = $("[data-swiper-slide-index=" + this.previousIndex + "]").find("video");
      //var currentVideo = $("[data-swiper-slide-index=" + this.realIndex + "]").find("video");
      var pSlide = $(swiper.slides[this.previousIndex]);
      var rSlide = $(swiper.slides[this.realIndex]);
      //var dataaw = rSlide.data;

      //console.log(pSlide.find("video"));
      //console.log(rSlide.find("video")[0]);
      //console.log(dataaw);

      //console.log(prevVideo);
      //console.log(currentVideo);
      let current = rSlide.find("video")[0];
      let previous = pSlide.find("video")[0];

      if (current) {
        current.play();
      }
      if (previous) {
        previous.currentTime = 0;
        previous.pause();
      }
      //window.stop()
      //prevVideo.pause();
      //currentVideo.play();
    });

    /*
       const videos = document.querySelectorAll('video');
   
       for (const video of videos) {
        video.addEventListener('click', function () {
           if (video.paused) {
             video.play();
           } else {
             video.pause();
           }
         });*/
    /*
          let isPaused = false;
          const observer = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
              if (entry.intersectionRatio !== 1 && !video.paused) {
                video.pause();
                isPaused = true;
              } else if (isPaused) {
                video.play();
                isPaused = false
              }
            });
          }, {
            threshold: 1
          });
          observer.observe(video);
  }*/
  </script>
</body>

</html>