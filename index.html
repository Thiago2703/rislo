<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Instagram Reels Clone</title>
  <link rel="stylesheet" href="./style.css" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/swiper@8/swiper-bundle.min.css" />
  <script src="https://unpkg.com/swiper@8/swiper-bundle.min.js"></script>
</head>

<body>
  <script src="./mpd-parser.js"></script>
  <script src='https://unpkg.com/@ffmpeg/ffmpeg/dist/ffmpeg.min.js'></script>
  <script src="./main.js"></script>

  <!--
  <div class="app__videos"></div>-->
  <div class="swiper-container">
    <div class="swiper-wrapper">
      <div class="swiper-slide" data-slide-type="img">Slide 1</div>
      <div class="swiper-slide" data-slide-type="img">Slide 2</div>
      <div class="swiper-slide" data-slide-type="img">Slide 3</div>
      <div class="swiper-slide" data-slide-type="img">Slide 5</div>
      <div class="swiper-slide" data-slide-type="img">Slide 6</div>
    </div>
    <!-- Add Arrows 
    <div class="swiper-button-next"></div>
    <div class="swiper-button-prev"></div>-->
  </div>
  <script>
    // variable 
    var VIDEO_PLAYING_STATE = {
      "PLAYING": "PLAYING",
      "PAUSE": "PAUSE"
    }
    var videoPlayStatus = VIDEO_PLAYING_STATE.PAUSE
    var timeout = null
    var waiting = 3000
    var swiper = new Swiper(
      '.swiper-container', {
      direction: "vertical",
      /*navigation: {
        nextEl: '.swiper-button-next',
        prevEl: '.swiper-button-prev',
      },*/
    });

    // HTML5 vdo object
    var options = {};
    var player = videojs('my-player', options);
    player.on('ended', function () {
      next()
    })

    // swiper object
    swiper.on('slideChangeTransitionEnd', function () {
      var index = swiper.activeIndex
      var currentSlide = $(swiper.slides[index])
      var currentSlideType = currentSlide.data('slide-type')

      // incase user click next before video ended
      if (videoPlayStatus === VIDEO_PLAYING_STATE.PLAYING) {
        player.pause()
      }

      clearTimeout(timeout)

      switch (currentSlideType) {
        case 'img':
          runNext()
          break;
        case 'vdo':
          player.currentTime(0)
          player.play()
          videoPlayStatus = VIDEO_PLAYING_STATE.PLAYING
          break;
        default:
          throw new Error('invalid slide type');
      }
    })

    // global function
    function prev() {
      swiper.slidePrev();
    }

    function next() {
      swiper.slideNext();
    }

    function runNext() {
      timeout = setTimeout(function () {
        next()
      }, waiting)
    }

    runNext()

    /*
       const videos = document.querySelectorAll('video');
   
       for (const video of videos) {
        video.addEventListener('click', function () {
           if (video.paused) {
             video.play();
           } else {
             video.pause();
           }
         });*/
    /*
          let isPaused = false;
          const observer = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
              if (entry.intersectionRatio !== 1 && !video.paused) {
                video.pause();
                isPaused = true;
              } else if (isPaused) {
                video.play();
                isPaused = false
              }
            });
          }, {
            threshold: 1
          });
          observer.observe(video);
  }*/
  </script>
</body>

</html>